<Window x:Class="MunicipalityApp.Windows.ServiceRequestStatusWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Service Request Status" Height="720" Width="1024"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource AppBackgroundGradient}">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="18">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="200"/>
            </Grid.RowDefinitions>

            <!-- Card container matching app styling -->
            <Border Grid.Row="0" Grid.RowSpan="4" Style="{StaticResource CenteredPageContainer}" Background="Transparent">
                <Border Style="{StaticResource MainCard}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <Grid Margin="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="200"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Service Request Status" Style="{StaticResource TitleText}"/>
                                <TextBlock Text="  â€” Browse, search by ID, and inspect advanced indexes" Style="{StaticResource BodyText}" Foreground="{StaticResource NeutralMutedBrush}" VerticalAlignment="Center" Margin="12,6,0,0"/>
                            </StackPanel>
                            <Button Grid.Column="1" Content="Back" Style="{StaticResource InCardButton}" Margin="12,0,0,0" Click="BtnBack_Click"/>
                        </Grid>

                        <!-- Controls: use WrapPanel so buttons will wrap on smaller widths and remain visible -->
                        <WrapPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Center" ItemHeight="36">
                            <TextBox x:Name="txtSearchId" Width="420" Height="32" VerticalAlignment="Center" Style="{StaticResource TextBoxStyle}" Foreground="{StaticResource TextPrimaryBrush}" />
                            <Button x:Name="btnFind" Content="Find" MinWidth="80" Height="32" Margin="8,4,0,4" Click="BtnFind_Click" Style="{StaticResource InCardButton}"/>
                            <Button x:Name="btnRefresh" Content="Refresh Indexes" MinWidth="120" Height="32" Margin="8,4,0,4" Click="BtnRefresh_Click" Style="{StaticResource InCardButton}"/>
                            <Button x:Name="btnNextPriority" Content="Next by Priority" MinWidth="120" Height="32" Margin="8,4,0,4" Click="BtnNextPriority_Click" Style="{StaticResource InCardButton}"/>
                            <!-- Mark Resolved button removed: use inline Status editing in the grid instead -->
                            <Button x:Name="btnShowMst" Content="Show Category MST" MinWidth="140" Height="32" Margin="8,4,0,4" Click="BtnShowMst_Click" Style="{StaticResource InCardButton}"/>
                            <Button x:Name="btnShowBfs" Content="Show Category BFS" MinWidth="120" Height="32" Margin="8,4,0,4" Click="BtnShowBfs_Click" Style="{StaticResource InCardButton}"/>
                        </WrapPanel>

                        <!-- Issues DataGrid -->
                        <DataGrid x:Name="dgIssues" Grid.Row="2" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="False" Margin="0,0,0,8"
                                  RowBackground="{StaticResource CardLightBrush}" AlternatingRowBackground="{StaticResource TableAlternateBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                                  FontFamily="{StaticResource AppFont}" FontSize="{StaticResource BodyFontSize}" CellEditEnding="dgIssues_CellEditEnding">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="300"/>
                                <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*"/>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="140"/>
                                <DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="140"/>
                                <DataGridTemplateColumn Header="Status" Width="140">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <ComboBox SelectedValuePath="Content" SelectedValue="{Binding Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      Width="120">
                                                <ComboBoxItem Content="Pending"/>
                                                <ComboBoxItem Content="In Progress"/>
                                                <ComboBoxItem Content="Completed"/>
                                                <ComboBoxItem Content="Resolved"/>
                                            </ComboBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Progress" Binding="{Binding Progress}" Width="90"/>
                                <DataGridTextColumn Header="Reported" Binding="{Binding ReportedDate, StringFormat=g}" Width="160"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Bottom: Index insights and MST/BFS output -->
                        <Grid Grid.Row="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="Overview" Style="{StaticResource SubtitleText}" Margin="0,0,0,6"/>
                                <TextBlock x:Name="txtStats" Text="" TextWrapping="Wrap" Style="{StaticResource BodyText}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <TextBlock Text="MST / BFS Output" Style="{StaticResource SubtitleText}" Margin="0,0,0,6"/>
                                <ListBox x:Name="lstMst" Height="120" Foreground="{StaticResource TextPrimaryBrush}"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>
            </Border>
        </Grid>
    </ScrollViewer>
</Window>
